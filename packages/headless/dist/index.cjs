'use client'
var pe=Object.create;var S=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var fe=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var bt=(t,e)=>{for(var o in e)S(t,o,{get:e[o],enumerable:!0})},w=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ue(e))!ge.call(t,n)&&n!==o&&S(t,n,{get:()=>e[n],enumerable:!(r=ce(e,n))||r.enumerable});return t},A=(t,e,o)=>(w(t,e,"default"),o&&w(o,e,"default")),d=(t,e,o)=>(o=t!=null?pe(fe(t)):{},w(e||!t||!t.__esModule?S(o,"default",{value:t,enumerable:!0}):o,t)),he=t=>w(S({},"__esModule",{value:!0}),t);var we={};bt(we,{AIHighlight:()=>Kt,CharacterCount:()=>mt.default,CodeBlockLowlight:()=>lt.default,Color:()=>et.Color,Command:()=>Gt,CustomKeymap:()=>Y,EditorBubble:()=>L,EditorBubbleItem:()=>O,EditorCommand:()=>H,EditorCommandEmpty:()=>J,EditorCommandItem:()=>D,EditorCommandList:()=>_,EditorContent:()=>k,EditorRoot:()=>q,GlobalDragHandle:()=>ct.default,HighlightExtension:()=>oe,HorizontalRule:()=>ne,ImageResizer:()=>Q,InputRule:()=>F.InputRule,MarkdownExtension:()=>re,Mathematics:()=>j,Placeholder:()=>ee,StarterKit:()=>dt.default,TaskItem:()=>nt.TaskItem,TaskList:()=>it.TaskList,TextStyle:()=>at.default,TiptapImage:()=>ot.default,TiptapLink:()=>rt.default,TiptapUnderline:()=>st.default,Twitter:()=>Z,UpdatedImage:()=>tt,UploadImagesPlugin:()=>ut,Youtube:()=>pt.default,addAIHighlight:()=>$t,createImageUpload:()=>ft,createSuggestionItems:()=>Xt,getAllContent:()=>de,getPrevText:()=>se,getUrlFromString:()=>ae,handleCommandNavigation:()=>Yt,handleImageDrop:()=>ht,handleImagePaste:()=>gt,isValidUrl:()=>yt,queryAtom:()=>x,rangeAtom:()=>y,removeAIHighlight:()=>Ft,renderItems:()=>Jt,useEditor:()=>X.useCurrentEditor});module.exports=he(we);var X=require("@tiptap/react"),Fe=require("@tiptap/core");var Rt=require("@tiptap/react"),Tt=require("jotai"),N=require("react"),It=d(require("tunnel-rat"),1);var g={};bt(g,{novelStore:()=>h});var Ct=require("jotai");A(g,require("jotai"));var h=(0,Ct.createStore)();var R=require("jotai"),p=require("react"),v=require("cmdk");var W=require("jotai"),x=(0,W.atom)(""),y=(0,W.atom)(null);var c=require("react/jsx-runtime"),M=(0,p.createContext)({}),xt=({query:t,range:e})=>{let o=(0,R.useSetAtom)(x,{store:h}),r=(0,R.useSetAtom)(y,{store:h});return(0,p.useEffect)(()=>{o(t)},[t,o]),(0,p.useEffect)(()=>{r(e)},[e,r]),(0,p.useEffect)(()=>{let n=["ArrowUp","ArrowDown","Enter"],i=a=>{if(n.includes(a.key)){a.preventDefault();let s=document.querySelector("#slash-command");return s&&s.dispatchEvent(new KeyboardEvent("keydown",{key:a.key,cancelable:!0,bubbles:!0})),!1}};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[]),(0,c.jsx)(M.Consumer,{children:n=>(0,c.jsx)(n.Out,{})})},H=(0,p.forwardRef)(({children:t,className:e,...o},r)=>{let[n,i]=(0,R.useAtom)(x);return(0,c.jsx)(M.Consumer,{children:a=>(0,c.jsx)(a.In,{children:(0,c.jsxs)(v.Command,{ref:r,onKeyDown:s=>{s.stopPropagation()},id:"slash-command",className:e,...o,children:[(0,c.jsx)(v.Command.Input,{value:n,onValueChange:i,style:{display:"none"}}),t]})})})}),_=v.Command.List;H.displayName="EditorCommand";var T=require("react/jsx-runtime"),q=({children:t})=>{let e=(0,N.useRef)((0,It.default)()).current;return(0,T.jsx)(Tt.Provider,{store:h,children:(0,T.jsx)(M.Provider,{value:e,children:t})})},k=(0,N.forwardRef)(({className:t,children:e,initialContent:o,...r},n)=>(0,T.jsx)("div",{ref:n,className:t,children:(0,T.jsx)(Rt.EditorProvider,{...r,content:o,children:e})}));k.displayName="EditorContent";var E=require("@tiptap/react"),u=require("react"),G=require("react/jsx-runtime"),L=(0,u.forwardRef)(({children:t,tippyOptions:e,...o},r)=>{let{editor:n}=(0,E.useCurrentEditor)(),i=(0,u.useRef)(null);(0,u.useEffect)(()=>{!i.current||!e?.placement||(i.current.setProps({placement:e.placement}),i.current.popperInstance?.update())},[e?.placement]);let a=(0,u.useMemo)(()=>({shouldShow:({editor:m,state:l})=>{let{selection:P}=l,{empty:C}=P;return!(!m.isEditable||m.isActive("image")||C||(0,E.isNodeSelection)(P))},tippyOptions:{onCreate:m=>{i.current=m,i.current.popper.firstChild?.addEventListener("blur",l=>{l.preventDefault(),l.stopImmediatePropagation()})},moveTransition:"transform 0.15s ease-out",...e},editor:n,...o}),[o,e]);return n?(0,G.jsx)("div",{ref:r,children:(0,G.jsx)(E.BubbleMenu,{...a,children:t})}):null});L.displayName="EditorBubble";var Pt=require("react"),wt=require("@radix-ui/react-slot"),St=require("@tiptap/react"),At=require("react/jsx-runtime"),O=(0,Pt.forwardRef)(({children:t,asChild:e,onSelect:o,...r},n)=>{let{editor:i}=(0,St.useCurrentEditor)(),a=e?wt.Slot:"div";return i?(0,At.jsx)(a,{ref:n,...r,onClick:()=>o?.(i),children:t}):null});O.displayName="EditorBubbleItem";var vt=require("react"),U=require("cmdk"),Mt=require("@tiptap/react"),Ht=require("jotai");var Nt=require("react/jsx-runtime"),D=(0,vt.forwardRef)(({children:t,onCommand:e,...o},r)=>{let{editor:n}=(0,Mt.useCurrentEditor)(),i=(0,Ht.useAtomValue)(y);return!n||!i?null:(0,Nt.jsx)(U.CommandItem,{ref:r,...o,onSelect:()=>e({editor:n,range:i}),children:t})});D.displayName="EditorCommandItem";var J=U.CommandEmpty;var F=require("@tiptap/core"),et=require("@tiptap/extension-color"),Qt=d(require("@tiptap/extension-highlight"),1),Zt=d(require("@tiptap/extension-horizontal-rule"),1),ot=d(require("@tiptap/extension-image"),1),rt=d(require("@tiptap/extension-link"),1),jt=d(require("@tiptap/extension-placeholder"),1),nt=require("@tiptap/extension-task-item"),it=require("@tiptap/extension-task-list"),at=d(require("@tiptap/extension-text-style"),1),st=d(require("@tiptap/extension-underline"),1),dt=d(require("@tiptap/starter-kit"),1),te=require("tiptap-markdown");var kt=require("@tiptap/core"),ye=kt.Extension.create({name:"CustomKeymap",addCommands(){return{selectTextWithinNodeBoundaries:()=>({editor:t,commands:e})=>{let{state:o}=t,{tr:r}=o,n=r.selection.$from.start(),i=r.selection.$to.end();return e.setTextSelection({from:n,to:i})}}},addKeyboardShortcuts(){return{"Mod-a":({editor:t})=>{let{state:e}=t,{tr:o}=e,r=o.selection.from,n=o.selection.to,i=o.selection.$from.start(),a=o.selection.$to.end();return r>i||n<a?(t.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),Y=ye;var Lt=require("@tiptap/react"),Ot=d(require("react-moveable"),1),Ut=require("react/jsx-runtime"),Q=()=>{let{editor:t}=(0,Lt.useCurrentEditor)();if(!t?.isActive("image"))return null;let e=()=>{let o=document.querySelector(".ProseMirror-selectednode");if(o){let r=t.state.selection,n=t.commands.setImage;n({src:o.src,width:Number(o.style.width.replace("px","")),height:Number(o.style.height.replace("px",""))}),t.commands.setNodeSelection(r.from)}};return(0,Ut.jsx)(Ot.default,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:o,width:r,height:n,delta:i})=>{i[0]&&(o.style.width=`${r}px`),i[1]&&(o.style.height=`${n}px`)},onResizeEnd:()=>{e()},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:o,transform:r})=>{o.style.transform=r}})};var b=require("@tiptap/core"),z=require("@tiptap/react"),Dt=require("react-tweet"),B=require("react/jsx-runtime"),Ee=/(https?:\/\/)?(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?/g,be=/^https?:\/\/(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?$/,Ce=t=>t.match(be),xe=({node:t})=>{let o=t?.attrs?.src?.split("/").pop();return o?(0,B.jsx)(z.NodeViewWrapper,{children:(0,B.jsx)("div",{"data-twitter":"",children:(0,B.jsx)(Dt.Tweet,{id:o})})}):null},Z=b.Node.create({name:"twitter",addOptions(){return{addPasteHandler:!0,HTMLAttributes:{},inline:!1,origin:""}},addNodeView(){return(0,z.ReactNodeViewRenderer)(xe,{attrs:this.options.HTMLAttributes})},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null}}},parseHTML(){return[{tag:"div[data-twitter]"}]},addCommands(){return{setTweet:t=>({commands:e})=>Ce(t.src)?e.insertContent({type:this.name,attrs:t}):!1}},addPasteRules(){return this.options.addPasteHandler?[(0,b.nodePasteRule)({find:Ee,type:this.type,getAttributes:t=>({src:t.input})})]:[]},renderHTML({HTMLAttributes:t}){return["div",(0,b.mergeAttributes)({"data-twitter":""},t)]}});var K=require("@tiptap/core"),Ye=require("@tiptap/pm/state"),Bt=d(require("katex"),1),j=K.Node.create({name:"math",inline:!0,group:"inline",atom:!0,selectable:!0,marks:"",addAttributes(){return{latex:""}},addOptions(){return{shouldRender:(t,e)=>{let o=t.doc.resolve(e);return o.parent.isTextblock?o.parent.type.name!=="codeBlock":!1},katexOptions:{throwOnError:!1},HTMLAttributes:{}}},addCommands(){return{setLatex:({latex:t})=>({chain:e,state:o})=>{if(!t)return!1;let{from:r,to:n,$anchor:i}=o.selection;return this.options.shouldRender(o,i.pos)?e().insertContentAt({from:r,to:n},{type:"math",attrs:{latex:t}}).setTextSelection({from:r,to:r+1}).run():!1},unsetLatex:()=>({editor:t,state:e,chain:o})=>{let r=t.getAttributes(this.name).latex;if(typeof r!="string")return!1;let{from:n,to:i}=e.selection;return o().command(({tr:a})=>(a.insertText(r,n,i),!0)).setTextSelection({from:n,to:n+r.length}).run()}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){let o=t.attrs.latex??"";return["span",(0,K.mergeAttributes)(e,{"data-type":this.name}),o]},renderText({node:t}){return t.attrs.latex??""},addNodeView(){return({node:t,HTMLAttributes:e,getPos:o,editor:r})=>{let n=document.createElement("span"),i=t.attrs.latex??"";return Object.entries(this.options.HTMLAttributes).forEach(([a,s])=>{n.setAttribute(a,s)}),Object.entries(e).forEach(([a,s])=>{n.setAttribute(a,s)}),n.addEventListener("click",a=>{if(r.isEditable&&typeof o=="function"){let s=o(),m=t.nodeSize;r.commands.setTextSelection({from:s,to:s+m})}}),n.contentEditable="false",n.innerHTML=Bt.default.renderToString(i,this.options.katexOptions),{dom:n}}}});var zt=d(require("@tiptap/extension-image"),1),Re=zt.default.extend({name:"image",addAttributes(){return{...this.parent?.(),width:{default:null},height:{default:null}}}}),tt=Re;var mt=d(require("@tiptap/extension-character-count"),1),lt=d(require("@tiptap/extension-code-block-lowlight"),1),pt=d(require("@tiptap/extension-youtube"),1),ct=d(require("tiptap-extension-global-drag-handle"),1);var f=require("@tiptap/core"),Te=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,Ie=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,Kt=f.Mark.create({name:"ai-highlight",addOptions(){return{HTMLAttributes:{}}},addAttributes(){return{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",(0,f.mergeAttributes)(this.options.HTMLAttributes,t),0]},addCommands(){return{setAIHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleAIHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetAIHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleAIHighlight()}},addInputRules(){return[(0,f.markInputRule)({find:Te,type:this.type})]},addPasteRules(){return[(0,f.markPasteRule)({find:Ie,type:this.type})]}}),Ft=t=>{let e=t.state.tr;e.removeMark(0,t.state.doc.nodeSize-2,t.state.schema.marks["ai-highlight"]),t.view.dispatch(e)},$t=(t,e)=>{t.chain().setAIHighlight({color:e??"#c1ecf970"}).run()};var Vt=require("@tiptap/core"),Wt=require("@tiptap/react"),_t=d(require("@tiptap/suggestion"),1),qt=d(require("tippy.js"),1);var Gt=Vt.Extension.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:t,range:e,props:o})=>{o.command({editor:t,range:e})}}}},addProseMirrorPlugins(){return[(0,_t.default)({editor:this.editor,...this.options.suggestion})]}}),Jt=t=>{let e=null,o=null;return{onStart:r=>{e=new Wt.ReactRenderer(xt,{props:r,editor:r.editor});let{selection:n}=r.editor.state;if(n.$from.node(n.$from.depth).type.name==="codeBlock")return!1;o=(0,qt.default)("body",{getReferenceClientRect:r.clientRect,appendTo:()=>t?t.current:document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:r=>{e?.updateProps(r),o?.[0]?.setProps({getReferenceClientRect:r.clientRect})},onKeyDown:r=>r.event.key==="Escape"?(o?.[0]?.hide(),!0):e?.ref?.onKeyDown(r),onExit:()=>{o?.[0]?.destroy(),e?.destroy()}}},Xt=t=>t,Yt=t=>{if(["ArrowUp","ArrowDown","Enter"].includes(t.key)&&document.querySelector("#slash-command"))return!0};var ee=jt.default.configure({placeholder:({node:t})=>t.type.name==="heading"?`Heading ${t.attrs.level}`:"Press '/' for commands",includeChildren:!0}),oe=Qt.default.configure({multicolor:!0}),re=te.Markdown.configure({html:!1,transformCopiedText:!0}),ne=Zt.default.extend({addInputRules(){return[new F.InputRule({find:/^(?:---|—-|___\s|\*\*\*\s)$/u,handler:({state:t,range:e})=>{let o={},{tr:r}=t,n=e.from,i=e.to;r.insert(n-1,this.type.create(o)).delete(r.mapping.map(n),r.mapping.map(i))}})]}});var $=require("@tiptap/pm/state"),V=require("@tiptap/pm/view"),I=new $.PluginKey("upload-image"),ut=({imageClass:t})=>new $.Plugin({key:I,state:{init(){return V.DecorationSet.empty},apply(e,o){o=o.map(e.mapping,e.doc);let r=e.getMeta(this);if(r?.add){let{id:n,pos:i,src:a}=r.add,s=document.createElement("div");s.setAttribute("class","img-placeholder");let m=document.createElement("img");m.setAttribute("class",t),m.src=a,s.appendChild(m);let l=V.Decoration.widget(i+1,s,{id:n});o=o.add(e.doc,[l])}else r?.remove&&(o=o.remove(o.find(void 0,void 0,n=>n.id==r.remove.id)));return o}},props:{decorations(e){return this.getState(e)}}});function Pe(t,e){let r=I.getState(t).find(void 0,void 0,n=>n.id==e);return r.length?r[0]?.from:null}var ft=({validateFn:t,onUpload:e})=>(o,r,n)=>{if(!t?.(o))return;let a={},s=r.state.tr;s.selection.empty||s.deleteSelection();let m=new FileReader;m.readAsDataURL(o),m.onload=()=>{s.setMeta(I,{add:{id:a,pos:n,src:m.result}}),r.dispatch(s)},e(o).then(l=>{let{schema:P}=r.state,C=Pe(r.state,a);if(C==null)return;let me=typeof l=="object"?m.result:l,Et=P.nodes.image?.create({src:me});if(!Et)return;let le=r.state.tr.replaceWith(C,C,Et).setMeta(I,{remove:{id:a}});r.dispatch(le)},()=>{let l=r.state.tr.delete(n,n).setMeta(I,{remove:{id:a}});r.dispatch(l)})},gt=(t,e,o)=>{if(e.clipboardData?.files.length){e.preventDefault();let[r]=Array.from(e.clipboardData.files),n=t.state.selection.from;return r&&o(r,t,n),!0}return!1},ht=(t,e,o,r)=>{if(!o&&e.dataTransfer?.files.length){e.preventDefault();let[n]=Array.from(e.dataTransfer.files),i=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&r(n,t,i?.pos??-1),!0}return!1};var ie=require("@tiptap/pm/model");function yt(t){try{return new URL(t),!0}catch{return!1}}function ae(t){if(yt(t))return t;try{if(t.includes(".")&&!t.includes(" "))return new URL(`https://${t}`).toString()}catch{return null}}var se=(t,e)=>{let o=[];t.state.doc.forEach((i,a)=>a>=e?!1:(o.push(i),!0));let r=ie.Fragment.fromArray(o),n=t.state.doc.copy(r);return t.storage.markdown.serializer.serialize(n)},de=t=>{let e=t.state.doc.content,o=t.state.doc.copy(e);return t.storage.markdown.serializer.serialize(o)};0&&(module.exports={AIHighlight,CharacterCount,CodeBlockLowlight,Color,Command,CustomKeymap,EditorBubble,EditorBubbleItem,EditorCommand,EditorCommandEmpty,EditorCommandItem,EditorCommandList,EditorContent,EditorRoot,GlobalDragHandle,HighlightExtension,HorizontalRule,ImageResizer,InputRule,MarkdownExtension,Mathematics,Placeholder,StarterKit,TaskItem,TaskList,TextStyle,TiptapImage,TiptapLink,TiptapUnderline,Twitter,UpdatedImage,UploadImagesPlugin,Youtube,addAIHighlight,createImageUpload,createSuggestionItems,getAllContent,getPrevText,getUrlFromString,handleCommandNavigation,handleImageDrop,handleImagePaste,isValidUrl,queryAtom,rangeAtom,removeAIHighlight,renderItems,useEditor});
