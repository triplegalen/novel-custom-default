'use client'
var H=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var tt=Object.prototype.hasOwnProperty;var et=(t,e)=>{for(var o in e)H(t,o,{get:e[o],enumerable:!0})},M=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of j(e))!tt.call(t,n)&&n!==o&&H(t,n,{get:()=>e[n],enumerable:!(r=Z(e,n))||r.enumerable});return t},y=(t,e,o)=>(M(t,e,"default"),o&&M(o,e,"default"));import{useCurrentEditor as vt}from"@tiptap/react";import{}from"@tiptap/core";import{EditorProvider as st}from"@tiptap/react";import{Provider as dt}from"jotai";import{forwardRef as mt,useRef as lt}from"react";import pt from"tunnel-rat";var l={};et(l,{novelStore:()=>p});y(l,We);import{createStore as ot}from"jotai";import*as We from"jotai";var p=ot();import{useAtom as rt,useSetAtom as k}from"jotai";import{useEffect as x,forwardRef as nt,createContext as it}from"react";import{Command as R}from"cmdk";import{atom as N}from"jotai";var E=N(""),u=N(null);import{jsx as f,jsxs as at}from"react/jsx-runtime";var b=it({}),L=({query:t,range:e})=>{let o=k(E,{store:p}),r=k(u,{store:p});return x(()=>{o(t)},[t,o]),x(()=>{r(e)},[e,r]),x(()=>{let n=["ArrowUp","ArrowDown","Enter"],i=a=>{if(n.includes(a.key)){a.preventDefault();let s=document.querySelector("#slash-command");return s&&s.dispatchEvent(new KeyboardEvent("keydown",{key:a.key,cancelable:!0,bubbles:!0})),!1}};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[]),f(b.Consumer,{children:n=>f(n.Out,{})})},T=nt(({children:t,className:e,...o},r)=>{let[n,i]=rt(E);return f(b.Consumer,{children:a=>f(a.In,{children:at(R,{ref:r,onKeyDown:s=>{s.stopPropagation()},id:"slash-command",className:e,...o,children:[f(R.Input,{value:n,onValueChange:i,style:{display:"none"}}),t]})})})}),O=R.List;T.displayName="EditorCommand";import{jsx as C}from"react/jsx-runtime";var U=({children:t})=>{let e=lt(pt()).current;return C(dt,{store:p,children:C(b.Provider,{value:e,children:t})})},I=mt(({className:t,children:e,initialContent:o,...r},n)=>C("div",{ref:n,className:t,children:C(st,{...r,content:o,children:e})}));I.displayName="EditorContent";import{BubbleMenu as ct,isNodeSelection as ut,useCurrentEditor as ft}from"@tiptap/react";import{forwardRef as gt,useEffect as ht,useMemo as yt,useRef as Et}from"react";import{jsx as D}from"react/jsx-runtime";var P=gt(({children:t,tippyOptions:e,...o},r)=>{let{editor:n}=ft(),i=Et(null);ht(()=>{!i.current||!e?.placement||(i.current.setProps({placement:e.placement}),i.current.popperInstance?.update())},[e?.placement]);let a=yt(()=>({shouldShow:({editor:d,state:m})=>{let{selection:h}=m,{empty:c}=h;return!(!d.isEditable||d.isActive("image")||c||ut(h))},tippyOptions:{onCreate:d=>{i.current=d,i.current.popper.firstChild?.addEventListener("blur",m=>{m.preventDefault(),m.stopImmediatePropagation()})},moveTransition:"transform 0.15s ease-out",...e},editor:n,...o}),[o,e]);return n?D("div",{ref:r,children:D(ct,{...a,children:t})}):null});P.displayName="EditorBubble";import{forwardRef as bt}from"react";import{Slot as Ct}from"@radix-ui/react-slot";import{useCurrentEditor as xt}from"@tiptap/react";import{jsx as Rt}from"react/jsx-runtime";var w=bt(({children:t,asChild:e,onSelect:o,...r},n)=>{let{editor:i}=xt(),a=e?Ct:"div";return i?Rt(a,{ref:n,...r,onClick:()=>o?.(i),children:t}):null});w.displayName="EditorBubbleItem";import{forwardRef as Tt}from"react";import{CommandEmpty as It,CommandItem as Pt}from"cmdk";import{useCurrentEditor as wt}from"@tiptap/react";import{useAtomValue as St}from"jotai";import{jsx as At}from"react/jsx-runtime";var S=Tt(({children:t,onCommand:e,...o},r)=>{let{editor:n}=wt(),i=St(u);return!n||!i?null:At(Pt,{ref:r,...o,onSelect:()=>e({editor:n,range:i}),children:t})});S.displayName="EditorCommandItem";var B=It;import{InputRule as W}from"@tiptap/core";import{Color as ue}from"@tiptap/extension-color";import fe from"@tiptap/extension-highlight";import ge from"@tiptap/extension-horizontal-rule";import he from"@tiptap/extension-image";import ye from"@tiptap/extension-link";import Ee from"@tiptap/extension-placeholder";import{TaskItem as be}from"@tiptap/extension-task-item";import{TaskList as Ce}from"@tiptap/extension-task-list";import xe from"@tiptap/extension-text-style";import Re from"@tiptap/extension-underline";import Te from"@tiptap/starter-kit";import{Markdown as Ie}from"tiptap-markdown";import{Extension as Mt}from"@tiptap/core";var Ht=Mt.create({name:"CustomKeymap",addCommands(){return{selectTextWithinNodeBoundaries:()=>({editor:t,commands:e})=>{let{state:o}=t,{tr:r}=o,n=r.selection.$from.start(),i=r.selection.$to.end();return e.setTextSelection({from:n,to:i})}}},addKeyboardShortcuts(){return{"Mod-a":({editor:t})=>{let{state:e}=t,{tr:o}=e,r=o.selection.from,n=o.selection.to,i=o.selection.$from.start(),a=o.selection.$to.end();return r>i||n<a?(t.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),z=Ht;import{useCurrentEditor as Nt}from"@tiptap/react";import kt from"react-moveable";import{jsx as Lt}from"react/jsx-runtime";var K=()=>{let{editor:t}=Nt();if(!t?.isActive("image"))return null;let e=()=>{let o=document.querySelector(".ProseMirror-selectednode");if(o){let r=t.state.selection,n=t.commands.setImage;n({src:o.src,width:Number(o.style.width.replace("px","")),height:Number(o.style.height.replace("px",""))}),t.commands.setNodeSelection(r.from)}};return Lt(kt,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:o,width:r,height:n,delta:i})=>{i[0]&&(o.style.width=`${r}px`),i[1]&&(o.style.height=`${n}px`)},onResizeEnd:()=>{e()},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:o,transform:r})=>{o.style.transform=r}})};import{Node as Ot,mergeAttributes as Ut,nodePasteRule as Dt}from"@tiptap/core";import{NodeViewWrapper as Bt,ReactNodeViewRenderer as zt}from"@tiptap/react";import{Tweet as Kt}from"react-tweet";import{jsx as A}from"react/jsx-runtime";var Ft=/(https?:\/\/)?(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?/g,$t=/^https?:\/\/(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?$/,Vt=t=>t.match($t),Wt=({node:t})=>{let o=t?.attrs?.src?.split("/").pop();return o?A(Bt,{children:A("div",{"data-twitter":"",children:A(Kt,{id:o})})}):null},F=Ot.create({name:"twitter",addOptions(){return{addPasteHandler:!0,HTMLAttributes:{},inline:!1,origin:""}},addNodeView(){return zt(Wt,{attrs:this.options.HTMLAttributes})},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null}}},parseHTML(){return[{tag:"div[data-twitter]"}]},addCommands(){return{setTweet:t=>({commands:e})=>Vt(t.src)?e.insertContent({type:this.name,attrs:t}):!1}},addPasteRules(){return this.options.addPasteHandler?[Dt({find:Ft,type:this.type,getAttributes:t=>({src:t.input})})]:[]},renderHTML({HTMLAttributes:t}){return["div",Ut({"data-twitter":""},t)]}});import{Node as _t,mergeAttributes as qt}from"@tiptap/core";import"@tiptap/pm/state";import Gt from"katex";var $=_t.create({name:"math",inline:!0,group:"inline",atom:!0,selectable:!0,marks:"",addAttributes(){return{latex:""}},addOptions(){return{shouldRender:(t,e)=>{let o=t.doc.resolve(e);return o.parent.isTextblock?o.parent.type.name!=="codeBlock":!1},katexOptions:{throwOnError:!1},HTMLAttributes:{}}},addCommands(){return{setLatex:({latex:t})=>({chain:e,state:o})=>{if(!t)return!1;let{from:r,to:n,$anchor:i}=o.selection;return this.options.shouldRender(o,i.pos)?e().insertContentAt({from:r,to:n},{type:"math",attrs:{latex:t}}).setTextSelection({from:r,to:r+1}).run():!1},unsetLatex:()=>({editor:t,state:e,chain:o})=>{let r=t.getAttributes(this.name).latex;if(typeof r!="string")return!1;let{from:n,to:i}=e.selection;return o().command(({tr:a})=>(a.insertText(r,n,i),!0)).setTextSelection({from:n,to:n+r.length}).run()}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){let o=t.attrs.latex??"";return["span",qt(e,{"data-type":this.name}),o]},renderText({node:t}){return t.attrs.latex??""},addNodeView(){return({node:t,HTMLAttributes:e,getPos:o,editor:r})=>{let n=document.createElement("span"),i=t.attrs.latex??"";return Object.entries(this.options.HTMLAttributes).forEach(([a,s])=>{n.setAttribute(a,s)}),Object.entries(e).forEach(([a,s])=>{n.setAttribute(a,s)}),n.addEventListener("click",a=>{if(r.isEditable&&typeof o=="function"){let s=o(),d=t.nodeSize;r.commands.setTextSelection({from:s,to:s+d})}}),n.contentEditable="false",n.innerHTML=Gt.renderToString(i,this.options.katexOptions),{dom:n}}}});import Jt from"@tiptap/extension-image";var Xt=Jt.extend({name:"image",addAttributes(){return{...this.parent?.(),width:{default:null},height:{default:null}}}}),V=Xt;import Pe from"@tiptap/extension-character-count";import we from"@tiptap/extension-code-block-lowlight";import Se from"@tiptap/extension-youtube";import Ae from"tiptap-extension-global-drag-handle";import{Mark as Yt,markInputRule as Qt,markPasteRule as Zt,mergeAttributes as jt}from"@tiptap/core";var te=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,ee=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,oe=Yt.create({name:"ai-highlight",addOptions(){return{HTMLAttributes:{}}},addAttributes(){return{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",jt(this.options.HTMLAttributes,t),0]},addCommands(){return{setAIHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleAIHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetAIHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleAIHighlight()}},addInputRules(){return[Qt({find:te,type:this.type})]},addPasteRules(){return[Zt({find:ee,type:this.type})]}}),re=t=>{let e=t.state.tr;e.removeMark(0,t.state.doc.nodeSize-2,t.state.schema.marks["ai-highlight"]),t.view.dispatch(e)},ne=(t,e)=>{t.chain().setAIHighlight({color:e??"#c1ecf970"}).run()};import{Extension as ie}from"@tiptap/core";import{ReactRenderer as ae}from"@tiptap/react";import se from"@tiptap/suggestion";import de from"tippy.js";var me=ie.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:t,range:e,props:o})=>{o.command({editor:t,range:e})}}}},addProseMirrorPlugins(){return[se({editor:this.editor,...this.options.suggestion})]}}),le=t=>{let e=null,o=null;return{onStart:r=>{e=new ae(L,{props:r,editor:r.editor});let{selection:n}=r.editor.state;if(n.$from.node(n.$from.depth).type.name==="codeBlock")return!1;o=de("body",{getReferenceClientRect:r.clientRect,appendTo:()=>t?t.current:document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:r=>{e?.updateProps(r),o?.[0]?.setProps({getReferenceClientRect:r.clientRect})},onKeyDown:r=>r.event.key==="Escape"?(o?.[0]?.hide(),!0):e?.ref?.onKeyDown(r),onExit:()=>{o?.[0]?.destroy(),e?.destroy()}}},pe=t=>t,ce=t=>{if(["ArrowUp","ArrowDown","Enter"].includes(t.key)&&document.querySelector("#slash-command"))return!0};var ve=Ee.configure({placeholder:({node:t})=>t.type.name==="heading"?`Heading ${t.attrs.level}`:"Press '/' for commands",includeChildren:!0}),Me=fe.configure({multicolor:!0}),He=Ie.configure({html:!1,transformCopiedText:!0}),Ne=ge.extend({addInputRules(){return[new W({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/u,handler:({state:t,range:e})=>{let o={},{tr:r}=t,n=e.from,i=e.to;r.insert(n-1,this.type.create(o)).delete(r.mapping.map(n),r.mapping.map(i))}})]}});import{Plugin as ke,PluginKey as Le}from"@tiptap/pm/state";import{Decoration as Oe,DecorationSet as Ue}from"@tiptap/pm/view";var g=new Le("upload-image"),_=({imageClass:t})=>new ke({key:g,state:{init(){return Ue.empty},apply(e,o){o=o.map(e.mapping,e.doc);let r=e.getMeta(this);if(r?.add){let{id:n,pos:i,src:a}=r.add,s=document.createElement("div");s.setAttribute("class","img-placeholder");let d=document.createElement("img");d.setAttribute("class",t),d.src=a,s.appendChild(d);let m=Oe.widget(i+1,s,{id:n});o=o.add(e.doc,[m])}else r?.remove&&(o=o.remove(o.find(void 0,void 0,n=>n.id==r.remove.id)));return o}},props:{decorations(e){return this.getState(e)}}});function De(t,e){let r=g.getState(t).find(void 0,void 0,n=>n.id==e);return r.length?r[0]?.from:null}var q=({validateFn:t,onUpload:e})=>(o,r,n)=>{if(!t?.(o))return;let a={},s=r.state.tr;s.selection.empty||s.deleteSelection();let d=new FileReader;d.readAsDataURL(o),d.onload=()=>{s.setMeta(g,{add:{id:a,pos:n,src:d.result}}),r.dispatch(s)},e(o).then(m=>{let{schema:h}=r.state,c=De(r.state,a);if(c==null)return;let Y=typeof m=="object"?d.result:m,v=h.nodes.image?.create({src:Y});if(!v)return;let Q=r.state.tr.replaceWith(c,c,v).setMeta(g,{remove:{id:a}});r.dispatch(Q)},()=>{let m=r.state.tr.delete(n,n).setMeta(g,{remove:{id:a}});r.dispatch(m)})},G=(t,e,o)=>{if(e.clipboardData?.files.length){e.preventDefault();let[r]=Array.from(e.clipboardData.files),n=t.state.selection.from;return r&&o(r,t,n),!0}return!1},J=(t,e,o,r)=>{if(!o&&e.dataTransfer?.files.length){e.preventDefault();let[n]=Array.from(e.dataTransfer.files),i=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&r(n,t,i?.pos??-1),!0}return!1};import{Fragment as Be}from"@tiptap/pm/model";function X(t){try{return new URL(t),!0}catch{return!1}}function ze(t){if(X(t))return t;try{if(t.includes(".")&&!t.includes(" "))return new URL(`https://${t}`).toString()}catch{return null}}var Ke=(t,e)=>{let o=[];t.state.doc.forEach((i,a)=>a>=e?!1:(o.push(i),!0));let r=Be.fromArray(o),n=t.state.doc.copy(r);return t.storage.markdown.serializer.serialize(n)},Fe=t=>{let e=t.state.doc.content,o=t.state.doc.copy(e);return t.storage.markdown.serializer.serialize(o)};export{oe as AIHighlight,Pe as CharacterCount,we as CodeBlockLowlight,ue as Color,me as Command,z as CustomKeymap,P as EditorBubble,w as EditorBubbleItem,T as EditorCommand,B as EditorCommandEmpty,S as EditorCommandItem,O as EditorCommandList,I as EditorContent,U as EditorRoot,Ae as GlobalDragHandle,Me as HighlightExtension,Ne as HorizontalRule,K as ImageResizer,W as InputRule,He as MarkdownExtension,$ as Mathematics,ve as Placeholder,Te as StarterKit,be as TaskItem,Ce as TaskList,xe as TextStyle,he as TiptapImage,ye as TiptapLink,Re as TiptapUnderline,F as Twitter,V as UpdatedImage,_ as UploadImagesPlugin,Se as Youtube,ne as addAIHighlight,q as createImageUpload,pe as createSuggestionItems,Fe as getAllContent,Ke as getPrevText,ze as getUrlFromString,ce as handleCommandNavigation,J as handleImageDrop,G as handleImagePaste,X as isValidUrl,E as queryAtom,u as rangeAtom,re as removeAIHighlight,le as renderItems,vt as useEditor};
